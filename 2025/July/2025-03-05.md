# Connecting Cube.js to Superset (PostgreSQL SQL API)

## ğŸ§© Goal

Connect Apache Superset to Cube.js using Cube's PostgreSQL SQL API on port `15432`, allowing Superset to query Cube.js pre-aggregated data.

---

## âš™ï¸ Prerequisites

- Cube.js project configured to expose PostgreSQL SQL API
- Superset installed in a Python virtual environment
- PostgreSQL driver (`psycopg2`) installed in Supersetâ€™s environment

---

## ğŸ§± 1. Cube.js Configuration

In your `.env` file for Cube.js:

```env
# Enable SQL API
CUBEJS_PG_SQL_PORT=15432
CUBEJS_SQL_USER=admin
CUBEJS_SQL_PASSWORD=admin

# PostgreSQL connection to actual data source (if applicable)
CUBEJS_DB_TYPE=postgres
CUBEJS_DB_HOST=localhost
CUBEJS_DB_PORT=5432
CUBEJS_DB_NAME=hviewtest
CUBEJS_DB_USER=postgres
CUBEJS_DB_PASS=password
CUBEJS_DB_SCHEMA=hviewdemo
```

Start Cube.js:

```bash
npm run dev
```

---

## ğŸš€ 2. Apache Superset Setup

### ğŸ“¦ Installation (inside a virtual environment)

```bash
python3 -m venv venv
source venv/bin/activate

# Install superset and dependencies
pip install apache-superset

# Initialize the database
superset db upgrade
superset fab create-admin  # Create admin user
superset init
```

### ğŸ§  Run Superset

```bash
superset run -p 8088 --with-threads --reload --debugger
```

Visit: [http://localhost:8088](http://localhost:8088)

---

## ğŸ§© 3. Connect Superset to Cube.js SQL API

In Superset UI:

1. Go to **Settings â†’ Database Connections**
2. Click **+ Database**
3. Select **PostgreSQL**
4. Fill in details:

    - **Display Name:** `Cube.js` (or any name)
    - **SQLAlchemy URI:**  
      ```
      postgresql+psycopg2://admin:admin@localhost:15432/postgres
      ```

5. Click **Connect**

---

## ğŸ§¨ Common Errors & Fixes

### âŒ `ModuleNotFoundError: No module named 'psycopg2'`

**Fix:**  
Activate your Superset venv and install the missing driver:

```bash
source venv/bin/activate
pip install psycopg2-binary
```

---

### âŒ Superset logo / favicon 404 errors

You may see logs like:

```
GET /static/assets/images/superset-logo-horiz.png HTTP/1.1" 404 -
```

ğŸŸ¡ *These are not critical â€” just missing branding assets. UI still works.*

---

### âŒ Unable to load SQLAlchemy dialect `shillelagh.multicorn2`

Superset log:

```
Unable to load SQLAlchemy dialect shillelagh.multicorn2: No module named 'psycopg2'
```

ğŸŸ¢ *This also results from the missing PostgreSQL driver (`psycopg2`). Installing it as shown above fixes both.*

---

### âŒ NPM Error: `package.json` not found

If you ran `npm install` inside Superset folder:

```
npm ERR! enoent ENOENT: no such file or directory, open '.../package.json'
```

ğŸ› ï¸ *You do not need to run `npm install` in Superset. Thatâ€™s for frontend development. Ignore this.*

---

## âœ… After Connection

- Go to **Datasets** in Superset
- Explore tables exposed by Cube.js schemas
- Build dashboards using those datasets

---

## ğŸ§ª Test the Connection via CLI (optional)

```bash
PGPASSWORD=admin psql -h localhost -p 15432 -U admin postgres
```

This lets you directly inspect what Cube.js is exposing via PostgreSQL.

---

## ğŸ§¼ Final Summary

| Component         | Status                        |
|-------------------|------------------------------|
| Cube.js SQL API   | âœ… Running on port 15432      |
| Superset          | âœ… Installed & running        |
| psycopg2          | âœ… Installed in venv          |
| Connection        | âœ… PostgreSQL â†’ Cube.js linked|

